<html lang="en">
<head>
<meta charset="UTF-8">
  <title>TESTING IN PROGRESS</title>
<style>
body { margin: 0; overflow: hidden; }
#info { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(0,0,0,0.5); padding: 8px; border-radius: 5px; font-family: sans-serif; }
</style>
</head>
<body>
<div id="info">
<b>W</b>: backward &nbsp; <b>S</b>: forward &nbsp; <b>A</b>: left &nbsp; <b>D</b>: right<br>
Hold <b>Shift</b> to run, <b>Space</b> to jump<br>
<b>1</b>: Third-person &nbsp; <b>2</b>: First-person &nbsp; <b>3</b>: Top-down view<br>
<b>Move mouse</b> to rotate camera, <b>Scroll</b> to zoom (except first-person)
</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
// Scene setup
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x222233);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 4, 8);

let cameraMode = 1; // 1: third-person, 2: first-person, 3: top-down

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0xffffff, 0.7));
const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
directionalLight.position.set(5, 10, 7.5);
scene.add(directionalLight);

// Original Ground (Visual only)
const groundGeometry = new THREE.PlaneGeometry(40, 40);
const groundMaterial = new THREE.MeshStandardMaterial({ color: 0x444444 });
const ground = new THREE.Mesh(groundGeometry, groundMaterial);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Endless Platform - ADDITION
const platformMaterial = new THREE.MeshStandardMaterial({ color: 0x555555 });
for (let i = -10; i <= 10; i++) {
  for (let j = -10; j <= 10; j++) {
    const tile = new THREE.Mesh(new THREE.BoxGeometry(2, 0.1, 2), platformMaterial);
    tile.position.set(i * 2, -0.05, j * 2);
    scene.add(tile);
  }
}

// Stickman
const stickman = new THREE.Group();
const material = new THREE.MeshStandardMaterial({ color: 0xffffff });

const head = new THREE.Mesh(new THREE.SphereGeometry(0.25), material);
head.position.y = 1.8;
stickman.add(head);

const body = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.6, 0.1), material);
body.position.y = 1.3;
stickman.add(body);

const leftLeg = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.6, 0.1), material);
leftLeg.position.set(-0.1, 0.6, 0);
stickman.add(leftLeg);

const rightLeg = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.6, 0.1), material);
rightLeg.position.set(0.1, 0.6, 0);
stickman.add(rightLeg);

const leftArm = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.5, 0.1), material);
leftArm.position.set(-0.25, 1.45, 0);
stickman.add(leftArm);

const rightArm = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.5, 0.1), material);
rightArm.position.set(0.25, 1.45, 0);
stickman.add(rightArm);

scene.add(stickman);

// Movement
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

let velocityY = 0;
let isGrounded = true;
const gravity = 0.015;
let walkCycle = 0;

function animate() {
  requestAnimationFrame(animate);

  let speed = keys['shift'] ? 0.2 : 0.1;
  let dx = 0, dz = 0;

  if (keys['w']) dz -= speed;
  if (keys['s']) dz += speed;
  if (keys['a']) dx -= speed;
  if (keys['d']) dx += speed;

  stickman.position.x += dx;
  stickman.position.z += dz;

  // Gravity
  const onPlatform = true; // always, since endless tiles
  if (stickman.position.y > 0.6 || !isGrounded) {
    velocityY -= gravity;
    stickman.position.y += velocityY;
    if (stickman.position.y <= 0.6) {
      stickman.position.y = 0.6;
      velocityY = 0;
      isGrounded = true;
    } else {
      isGrounded = false;
    }
  }

  if (keys[' '] && isGrounded) {
    velocityY = 0.25;
    isGrounded = false;
  }

  // Animate limbs (slowed down)
  walkCycle += speed * 3;
  const swing = Math.sin(walkCycle) * 0.5;
  leftLeg.rotation.x = swing;
  rightLeg.rotation.x = -swing;
  leftArm.rotation.x = -swing;
  rightArm.rotation.x = swing;

  // Camera follows
  if (cameraMode === 1) {
    camera.position.set(stickman.position.x + 5, stickman.position.y + 4, stickman.position.z + 5);
    camera.lookAt(stickman.position);
  } else if (cameraMode === 2) {
    camera.position.set(stickman.position.x, stickman.position.y + 1.6, stickman.position.z);
    camera.lookAt(stickman.position.x, stickman.position.y + 1.6, stickman.position.z + 1);
  } else if (cameraMode === 3) {
    camera.position.set(stickman.position.x, stickman.position.y + 10, stickman.position.z);
    camera.lookAt(stickman.position);
  }

  renderer.render(scene, camera);
}

animate();

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

document.addEventListener('keydown', e => {
  if (e.key === '1') cameraMode = 1;
  if (e.key === '2') cameraMode = 2;
  if (e.key === '3') cameraMode = 3;
});
</script>
</body>
</html>

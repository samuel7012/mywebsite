<html lang="en">
<head>
<meta charset="UTF-8">
<title>TESTING IN PROGRES</title>
<style>
body { margin: 0; overflow: hidden; }
#info { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(0,0,0,0.5); padding: 8px; border-radius: 5px; font-family: sans-serif; }
</style>
</head>
<body>
<div id="info" style="display:none">
<b>W</b>: backward &nbsp; <b>S</b>: forward &nbsp; <b>A</b>: left &nbsp; <b>D</b>: right<br>
Hold <b>Shift</b> to run, <b>Space</b> to jump<br>
<b>1</b>: Third-person &nbsp; <b>2</b>: First-person &nbsp; <b>3</b>: Top-down view<br>
<b>Move mouse</b> to rotate camera, <b>Scroll</b> to zoom (except first-person)<br>
<b>Arrow Keys</b>: Rotate camera
</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
// ... (all your code above unchanged) ...

// Animate
function animate() {
  requestAnimationFrame(animate);

  // Camera-relative movement
  let dx = 0, dz = 0;
  if (moveForward) {
    dx += Math.sin(azimuth) * walkSpeed;
    dz += Math.cos(azimuth) * walkSpeed;
  }
  if (moveBackward) {
    dx -= Math.sin(azimuth) * walkSpeed;
    dz -= Math.cos(azimuth) * walkSpeed;
  }
  if (moveLeft) {
    dx += Math.sin(azimuth - Math.PI/2) * walkSpeed;
    dz += Math.cos(azimuth - Math.PI/2) * walkSpeed;
  }
  if (moveRight) {
    dx += Math.sin(azimuth + Math.PI/2) * walkSpeed;
    dz += Math.cos(azimuth + Math.PI/2) * walkSpeed;
  }

  if ((moveForward || moveBackward || moveLeft || moveRight) && isRunning) {
    dx *= runSpeed / walkSpeed;
    dz *= runSpeed / walkSpeed;
  }

  stickman.position.x += dx;
  stickman.position.z += dz;

  // Jumping/Gravity
  if (isJumping || !isGrounded) {
    stickman.position.y += velocityY;
    velocityY -= gravity;
    if (stickman.position.y <= 0) {
      stickman.position.y = 0;
      isJumping = false;
      isGrounded = true;
      velocityY = 0;
    } else {
      isGrounded = false;
    }
  } else {
    stickman.position.y = 0;
  }

  // Face direction of movement (except top-down)
  if (cameraMode !== 3 && (dx !== 0 || dz !== 0)) {
    stickman.rotation.y = Math.atan2(dx, dz);
  }

  // Animation state
  let state = "idle";
  if (isJumping || !isGrounded) state = "jump";
  else if (dx !== 0 || dz !== 0) state = isRunning ? "run" : "walk";
  // Removed animateStickman(state);

  // KEY CHANGE: run animation is slower
  if (state === "walk" || state === "run") walkCycle += isRunning ? 0.024 : 0.024;
  else walkCycle += 0.012;

  updateCamera();
  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', function() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
